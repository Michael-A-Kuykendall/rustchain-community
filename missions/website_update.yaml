name: "Website Update Mission"
description: "Automated CI/CD mission to update the RustChain website with latest changes"
version: "1.0"

config:
  fail_fast: false
  max_parallel: 2
  timeout_seconds: 300

steps:
  - id: "check_website_dir"
    name: "Verify Website Directory Exists"
    step_type: "Command"
    parameters:
      command: "test"
      args: ["-d", "website"]
    continue_on_error: false
    timeout_seconds: 10

  - id: "pull_latest_changes"
    name: "Pull Latest Changes from GitHub"
    step_type: "Command"
    parameters:
      command: "git"
      args: ["pull", "origin", "main"]
      working_directory: "website"
    depends_on: ["check_website_dir"]
    continue_on_error: false
    timeout_seconds: 30

  - id: "install_dependencies"
    name: "Install/Update Website Dependencies"
    step_type: "Command"
    parameters:
      command: "npm"
      args: ["install"]
      working_directory: "website"
    depends_on: ["pull_latest_changes"]
    continue_on_error: false
    timeout_seconds: 120

  - id: "update_version_info"
    name: "Update Website with RustChain Version Info"
    step_type: "CreateFile"
    parameters:
      path: "website/src/data/rustchain-info.ts"
      content: |
        // Auto-generated by RustChain CI/CD
        export const rustchainInfo = {
          version: "{{ rustchain_version }}",
          lastUpdated: "{{ current_timestamp }}",
          commitHash: "{{ commit_hash }}",
          features: [
            "Enterprise AI Agent Framework",
            "Mission-Based Execution",
            "Compliance Validation (8 Standards)",
            "Safety-First Architecture",
            "OpenAI-Compatible API",
            "Production-Ready Performance"
          ]
        };
    depends_on: ["install_dependencies"]
    continue_on_error: false
    timeout_seconds: 10

  - id: "run_tests"
    name: "Run Website Tests"
    step_type: "Command"
    parameters:
      command: "npm"
      args: ["run", "lint"]
      working_directory: "website"
    depends_on: ["update_version_info"]
    continue_on_error: true
    timeout_seconds: 60

  - id: "build_website"
    name: "Build Website for Production"
    step_type: "Command"
    parameters:
      command: "npm"
      args: ["run", "build"]
      working_directory: "website"
    depends_on: ["run_tests"]
    continue_on_error: false
    timeout_seconds: 120

  - id: "commit_changes"
    name: "Commit Website Updates"
    step_type: "Command"
    parameters:
      command: "git"
      args: ["add", "-A"]
      working_directory: "website"
    depends_on: ["build_website"]
    continue_on_error: true
    timeout_seconds: 10

  - id: "push_changes"
    name: "Push Website Updates to GitHub"
    step_type: "Command"
    parameters:
      command: "git"
      args: ["commit", "-m", "ðŸ¤– Auto-update from RustChain CI/CD - {{ current_timestamp }}"]
      working_directory: "website"
    depends_on: ["commit_changes"]
    continue_on_error: true
    timeout_seconds: 30

  - id: "deploy_trigger"
    name: "Trigger Deployment (GitHub Auto-Deploy)"
    step_type: "Command"
    parameters:
      command: "git"
      args: ["push", "origin", "main"]
      working_directory: "website"
    depends_on: ["push_changes"]
    continue_on_error: true
    timeout_seconds: 30

  - id: "deployment_status"
    name: "Log Deployment Status"
    step_type: "CreateFile"
    parameters:
      path: "mission-outputs/website-deployment-{{ current_timestamp }}.log"
      content: |
        âœ… RustChain Website Update Mission Completed
        ================================================
        
        Timestamp: {{ current_timestamp }}
        RustChain Version: {{ rustchain_version }}
        Commit Hash: {{ commit_hash }}
        
        Steps Completed:
        - âœ… Website directory verified
        - âœ… Latest changes pulled from GitHub
        - âœ… Dependencies updated
        - âœ… RustChain version info updated
        - âœ… Website built successfully
        - âœ… Changes committed and pushed
        - âœ… Auto-deployment triggered
        
        Website URL: https://your-deployment-url.com
        Local Dev: http://localhost:8080
        
        Next deployment will happen automatically when
        this mission runs again via CI/CD triggers.
    depends_on: ["deploy_trigger"]
    continue_on_error: false
    timeout_seconds: 10